# 电子围栏报警设置功能说明

## 功能概述

本次更新为电子围栏系统添加了报警设置功能，用户现在可以为每个围栏配置不同的报警触发方式。

## 实现的功能

### 1. 报警类型设置

在围栏创建页面，用户可以选择以下三种报警方式：

- **进入围栏**: 仅在进入围栏时报警
- **离开围栏**: 仅在离开围栏时报警  
- **进出围栏**: 进入和离开围栏时都报警（默认设置）

### 2. 报警设置显示

在围栏管理页面的围栏列表中，现在会显示每个围栏的报警设置：

- 显示蓝色通知图标
- 显示报警类型文字描述
- 与围栏状态（已启用/已暂停）信息并列显示

## 技术实现

### 1. 数据模型更新

**文件**: `lib/models/geofence_model.dart`

- 新增 `GeofenceAlertType` 枚举类型：
  ```dart
  enum GeofenceAlertType {
    enter('进入围栏'),
    exit('离开围栏'),
    both('进出围栏');
  }
  ```

- 在 `GeofenceModel` 类中添加 `alertType` 字段：
  ```dart
  final GeofenceAlertType alertType; // 报警设置
  ```

- 更新所有相关的构造函数、序列化和反序列化方法

### 2. 创建页面更新

**文件**: `lib/routes/geofence_creation_page.dart`

- 添加报警设置选择界面
- 实现 `_getSelectedAlertType()` 方法转换选择值
- 在创建围栏时保存报警设置到模型
- 默认选择"进出围栏"报警模式

### 3. 管理页面更新

**文件**: `lib/routes/geofence_management_page.dart`

- 在围栏卡片的 subtitle 中添加报警设置显示
- 使用蓝色通知图标和文字显示报警类型
- 保持原有的围栏类型、半径、状态等信息显示

## 界面效果

### 创建页面

```
围栏类型
[圆形围栏] [多边形围栏]

围栏名称  
[输入框]

报警设置
[进入围栏] [离开围栏] [进出围栏] ✓
```

### 管理页面

```
📍 家庭围栏
圆形围栏
半径: 100米
🔔 报警: 进出围栏
✅ 已启用
```

## 兼容性说明

- 新字段 `alertType` 有默认值 `GeofenceAlertType.both`
- 现有围栏数据会自动使用默认报警设置
- 不影响现有的围栏检测和事件触发逻辑

## 使用方法

1. **创建带报警设置的围栏**：
   - 进入围栏创建页面
   - 选择围栏类型和设置位置
   - 在"报警设置"区域选择期望的报警方式
   - 保存围栏

2. **查看围栏报警设置**：
   - 进入围栏管理页面
   - 在围栏列表中查看每个围栏的报警设置
   - 报警设置显示在围栏状态信息上方

## 扩展说明

此功能为后续的智能报警和通知系统奠定了基础，可以进一步扩展：

- 支持不同报警方式（推送通知、短信、邮件等）
- 支持报警频率控制
- 支持报警时间段设置
- 支持多级报警策略

---

**更新时间**: 2024年12月19日  
**涉及文件**: 
- `lib/models/geofence_model.dart`
- `lib/routes/geofence_creation_page.dart` 
- `lib/routes/geofence_management_page.dart` 