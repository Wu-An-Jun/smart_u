# 智能管家页面跳转功能说明

## 功能概述

智能管家应用现在支持AI聊天中的智能页面跳转功能。当用户表达想要访问特定功能或页面的意图时，AI会识别用户需求并在聊天界面中显示一个跳转按钮，用户点击即可直接跳转到对应页面。

## 实现原理

### 1. AI识别用户意图
AI通过分析用户的自然语言输入，识别出用户想要访问的功能页面，然后返回包含页面信息的JSON响应。

### 2. JSON响应格式
```json
{
  "action": "navigate",
  "page_code": 40,
  "page_name": "自动化创建",
  "reason": "用户需要创建定时开灯的自动化规则"
}
```

### 3. Flutter端处理
Flutter应用解析AI返回的JSON，提取导航信息，并在聊天界面中显示一个可点击的跳转按钮。

## 支持的页面编号

| 编号 | 页面名称 | 功能描述 | 触发关键词示例 |
|------|---------|---------|---------------|
| 10 | 首页 | 智能管家主界面 | "回到首页"、"主页" |
| 20 | 设备管理 | 智能设备管理 | "我的设备"、"设备管理"、"查看设备" |
| 21 | 设备列表 | 设备列表详情 | "设备列表"、"所有设备" |
| 22 | 添加设备 | 添加新设备 | "添加设备"、"新增设备" |
| 30 | 智能生活 | 智能家居管理 | "智能生活"、"智能家居"、"场景模式" |
| 40 | 自动化创建 | 创建自动化规则 | "自动化"、"定时任务"、"规则设置" |
| 50 | AI助手 | AI开发助手 | "AI助手"、"智能助手" |
| 60 | 服务 | 各类服务功能 | "服务"、"客服"、"帮助" |
| 70 | 地图 | 地图定位功能 | "地图"、"定位"、"我的位置" |
| 80 | 个人资料 | 个人信息管理 | "个人资料"、"我的信息"、"设置" |

## 使用示例

### 示例1：设备管理
**用户输入**: "我想看看我的设备"

**AI识别**: 用户想要查看和管理智能设备

**AI返回**:
```json
{
  "action": "navigate",
  "page_code": 20,
  "page_name": "设备管理",
  "reason": "用户想要查看和管理智能设备"
}
```

**界面显示**: 聊天界面显示"我来帮您打开设备管理页面"的文字和"打开设备管理"的按钮

### 示例2：自动化设置
**用户输入**: "帮我设置定时开灯"

**AI识别**: 用户需要创建定时开灯的自动化规则

**AI返回**:
```json
{
  "action": "navigate",
  "page_code": 40,
  "page_name": "自动化创建",
  "reason": "用户需要创建定时开灯的自动化规则"
}
```

**界面显示**: 显示跳转到自动化创建页面的按钮

### 示例3：地图定位
**用户输入**: "我现在在哪里"

**AI识别**: 用户想要查看当前位置

**AI返回**:
```json
{
  "action": "navigate",
  "page_code": 70,
  "page_name": "地图",
  "reason": "用户想要查看当前位置信息"
}
```

## 技术实现

### 1. 页面导航工具类 (PageNavigator)
```dart
// 根据页面编号跳转
PageNavigator.navigateToPage(pageCode);

// 创建跳转按钮
PageNavigator.createNavigationButton(pageCode);
```

### 2. AI响应解析
```dart
// 解析AI返回的导航JSON
AINavigationResponse? _parseNavigationResponse(String response)

// 提取文本内容
String _extractTextFromResponse(String response, AINavigationResponse navigationInfo)
```

### 3. 聊天消息扩展
```dart
class ChatMessage {
  final String text;
  final bool isUser;
  final AINavigationResponse? navigationInfo; // 新增导航信息
}
```

## 按钮样式

跳转按钮采用统一的设计风格：
- 紫色背景 (#6B4DFF)
- 白色文字
- 圆角设计
- 带有箭头图标
- 响应式点击效果

## 用户体验优化

1. **智能识别**: AI能够理解各种自然语言表达方式
2. **即时反馈**: 按钮点击后立即跳转并显示确认提示
3. **错误处理**: 当页面不存在时显示友好的错误提示
4. **上下文感知**: 结合对话历史理解用户真实意图

## 扩展性

系统设计具有良好的扩展性：
- 新页面只需在映射表中添加编号
- AI提示词可以轻松添加新的识别规则
- 按钮样式和行为可以统一配置

## 注意事项

1. **JSON格式**: AI返回的JSON必须严格按照规定格式
2. **编号有效性**: 页面编号必须在映射表中存在
3. **用户权限**: 某些页面可能需要检查用户权限
4. **网络状态**: 跳转前应确保网络连接正常

这个功能为智能管家应用提供了更加智能和便捷的导航体验，让用户能够通过自然语言快速访问所需功能。 